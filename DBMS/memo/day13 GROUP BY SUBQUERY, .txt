--GROUP BY : ~ 별(예 : 포지션 별 평균 키)
--SELECT ??? FROM ???
--WHERE 조건
--GROUP BY
--HAVING 조건

--PLAYER 테이블에서 포지션 검색
SELECT "POSITION" FROM PLAYER
GROUP BY "POSITION"
HAVING "POSITION" IS NOT NULL;

--WHERE 절에서 조건을 처리할 수 있다면 반드시 WHERE절에서 먼저 처리 해준다.
--이것이 효율적
SELECT "POSITION" FROM PLAYER
WHERE "POSITION" IS NOT NULL
GROUP BY "POSITION";

--PLAYER 테이블에서 몸무게가 80이상인 선수들의 평균키가 180이상인 포지션 검색
SELECT "POSITION", ROUND(AVG(HEIGHT),2),MIN(WEIGHT) FROM PLAYER
WHERE WEIGHT >=80  
GROUP BY "POSITION"
HAVING AVG(HEIGHT) >=180;

-------------------------------------------------------------------------------
--SUB QUERY
-- FROM 절 : IN LINE VIEW
-- SELECT 절 : SCALAR
-- WHERE 절 : SUB QUERY


--PLAYER 테이블에서 TEAM_ID가 'K01'인 선수 중 포지션이 'GK'인 선수
SELECT * FROM 
(
	SELECT * FROM PLAYER WHERE TEAM_ID = 'K01'
)
WHERE "POSITION" = 'GK';

---PLAYER 테이블 에서 평균 키보다 작은 선수
SELECT * FROM PLAYER
WHERE HEIGHT < (SELECT AVG(HEIGHT)FROM PLAYER);

--PLAYER 테이블에서 전체 평균과 포지션별 평균 키 구하기
SELECT "POSITION" "포지션",AVG(HEIGHT) "포지션 별 평균 키",(SELECT AVG(HEIGHT)FROM PLAYER) "전체 평균" FROM PLAYER
WHERE "POSITION" IS NOT NULL
GROUP BY "POSITION";

--위의 예제 CASE 문으로
SELECT 
	ROUND(AVG(CASE "POSITION" WHEN 'GK' THEN HEIGHT END),2) "GK",
	ROUND(AVG(CASE "POSITION" WHEN 'DF' THEN HEIGHT END),2) "DF",
	ROUND(AVG(CASE "POSITION" WHEN 'FW' THEN HEIGHT END),2) "FW",
	ROUND(AVG(CASE "POSITION" WHEN 'MF' THEN HEIGHT END),2) "MF",
	ROUND(AVG(HEIGHT),2) "전체 평균"
FROM PLAYER;


--EMPLOYEES 테이블에서 평균 급여보다 낮은 사원들의 급여를 10% 인상
SELECT AVG(SALARY) FROM EMPLOYEES; --6461.83
SELECT * FROM EMPLOYEES WHERE SALARY < (SELECT AVG(SALARY)FROM EMPLOYEES);


UPDATE EMPLOYEES
SET SALARY = SALARY * 1.1
WHERE SALARY < (SELECT AVG(SALARY)FROM EMPLOYEES);








